
close all;clear;clc

% K is camera internal matrix
% the camera in my Huawei phone is used.
K=[336.5284163681163, 0, 117.7561644786855;
  0, 334.6710168539478, 207.2730334866136;
  0, 0, 1];

uv1 = [
[183.032, 101.642]
[219.192, 108.901]
[221.082, 111.389]
[280.866, 129.278]
[233.162, 115.581]
[250.167, 119.317]
[173.613, 167.869]
[277.054, 129.71]
[277.054, 129.71]
[321.805, 142.015]
[287.474, 131.272]
[241.587, 200.011]
[178.145, 139.331]
[210.191, 101.736]
[344.095, 37.0277]
[344.095, 37.0277]
[242.852, 117.013]
[230.882, 113.013]
[298.197, 176.622]
[224.647, 111.071]
[268.085, 125.124]
[274.612, 127.103]
[155.889, 89.1132]
[265.501, 197.054]
[256.551, 120.919]
[195.939, 184.575]
[212.717, 108.971]
[295.776, 207.419]
[188.371, 151.395]
[211.044, 189.607]    
]';
uv2 = [
[182.535, 99.5214]
[216.057, 119.774]
[217.501, 123.085]
[270.529, 161.774]
[228.247, 131.739]
[243.816, 141.432]
[160.81, 154.563]
[266.676, 160.885]
[266.676, 160.885]
[305.445, 188.062]
[276.18, 165.969]
[187.76, 205.995]
[169.803, 144.741]
[210, 109.66]
[363.102, 93.3032]
[363.102, 93.3032]
[237.382, 136.368]
[226.839, 128.125]
[263.002, 208.045]
[221.374, 124.004]
[259.616, 153.269]
[265.189, 157.455]
[158.317, 76.1036]
[239.457, 230.508]
[248.925, 145.043]
[173.632, 195.499]
[164.735, 171.109]
[239.457, 230.508]
[173.32, 154.785]
[173.632, 195.499]    
]';

rand_book=[1:30];
for i=1:30
    k=ceil( rand()*length(rand_book) );
   rand_choose(i) = rand_book(k);
   rand_book(k)=[];
end
rand_choose=[11,23,8,26,15,17,18,1,19,6,5,20,...
    10,3,25,16,22,24,28,13,27,14,12,21,4,29,7,9,2,30];

uv1 = uv1(:,[rand_choose]);
uv2 = uv2(:,[rand_choose]);

tmp=[];
for i=1:8
    tmp=[tmp; uv1(1,i)*uv2(1,i), uv1(1,i)*uv2(2,i), uv1(1,i), uv1(2,i)*uv2(1,i), uv1(2,i)*uv2(2,i), uv1(2,i), uv2(1,i), uv2(2,i), 1];
end


y=null( tmp, rank(tmp) );
y=y';

F=[y(1:3); y(4:6); y(7:9)];

E=K'*F*K;

[U, S, V] = svd(E)
